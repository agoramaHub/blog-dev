<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../assets/ideal-image-slider.css">
	<link rel="stylesheet" href="../assets/themes/default/default.css"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Sensor IoT Workshop - Heart Rate | Agorama</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Sensor IoT Workshop - Heart Rate" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Working with RPI and Heart Sensors" />
<meta property="og:description" content="Working with RPI and Heart Sensors" />
<link rel="canonical" href="http://localhost:4000/education/2019/03/16/heart-sensor-rpi.html" />
<meta property="og:url" content="http://localhost:4000/education/2019/03/16/heart-sensor-rpi.html" />
<meta property="og:site_name" content="Agorama" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-03-16T13:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Sensor IoT Workshop - Heart Rate" />
<script type="application/ld+json">
{"datePublished":"2019-03-16T13:00:00+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/education/2019/03/16/heart-sensor-rpi.html"},"url":"http://localhost:4000/education/2019/03/16/heart-sensor-rpi.html","headline":"Sensor IoT Workshop - Heart Rate","dateModified":"2019-03-16T13:00:00+00:00","description":"Working with RPI and Heart Sensors","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Agorama" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title glitch-link" rel="author" href="/">
      <span class="glitch">
      <img src="/assets/Glitch.png"/>
      </span>
    </a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link navLinks glitch-link" href="/about/"><span class="glitch">
              About
            </span></a><a class="page-link navLinks glitch-link" href="/projects/"><span class="glitch">
              Projects
            </span></a><a class="page-link navLinks glitch-link" href="http://amapad.bot.nu/"><span class="glitch">
              Texts
            </span></a><a class="page-link navLinks glitch-link" href="/resources/"><span class="glitch">
              Resources
            </span></a><a class="page-link navLinks glitch-link" href="/contact/"><span class="glitch">
              Contact
            </span></a></div>
      </nav></div>
</header>

<!-- Agorama -->
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Sensor IoT Workshop - Heart Rate</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-03-16T13:00:00+00:00" itemprop="datePublished">Mar 16, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3 id="️-heart-detector-for-arduino-️">❤️ Heart Detector for Arduino ❤️</h3>

<ul>
  <li>x1 Arduino uno</li>
  <li>x1 pulse sensor</li>
  <li>PulseSensor Playground library</li>
</ul>

<h4 id="step-1---wire-up-the-pulse-sensor-to-the-arduino">Step 1 - Wire up the Pulse Sensor to the Arduino</h4>

<p><img src="/images/pulsesensor-pins.png" alt="alt text" /></p>

<ul>
  <li>RED wire = +3V to +5V</li>
  <li>BLACK wire = GND</li>
  <li>PURPLE wire = Signal</li>
</ul>

<h4 id="step-2---install-pulsesensorplayground-library-for-arduino">Step 2 - Install PulseSensorPlayground library for Arduino</h4>

<ul>
  <li>To install the PulseSensor Playground Library, in Arduino, to go ‘'’Sketch &gt; Include Library &gt; Manage Library…’’’</li>
  <li>In the Library Manager: Search for and Select “PulseSensor.com</li>
  <li>Install or update to the lastest version.+1</li>
  <li>Once this library is installed you will see our examples in Arduino’s dropdown! To select an example project, go to:</li>
</ul>

<p><img src="/images/pulsesensor-lib.png" alt="" /></p>

<p>Get the latest Arduino software here [https://github.com/WorldFamousElectronics/PulseSensorPlayground] (https://github.com/WorldFamousElectronics/PulseSensorPlayground)
Follow the README guide to get set up, or follow this Getting Started Tutorial
For Arduino IDE download: <a href="https://www.arduino.cc/en/Main/Software">https://www.arduino.cc/en/Main/Software</a></p>

<p>Connect the Pulse Sensor to: +V (red), Ground (black), and Analog Pin 0 (purple) on your favorite Arduino, or Arduino compatible device, Then find the Getting Started sketch by clicking
    File &gt; Examples &gt; PulseSensor Playground &gt; A_StarterProject_and_SignalTester</p>

<h4 id="step-3---connect-the-sensor-to-the-body">Step 3 - Connect the sensor to the body</h4>

<p>The pulse sensor works by being attached to either earlobe or end of finger. If you’re having trouble seeing a heartbeat, make sure that you are using ‘Goldilocks’ pressure on the Pulse Sensor: Not too hard, not too soft. Squeezing the Pulse Sensor too hard against your skin will make the heartbeat go away, and not enough pressure will cause too much noise to creep in!
If this code is reading too many Beats Per Minute, or you are getting lots of noise, try adjusting the Threshold setting. The Threshold variable tells Arduino when to find a pulse that is legit. Adjust the Threshold value (noted above with arrows).  The Threshold can be any number between 0-1024, but try adjusting by steps of 5 or 10.  Decreasing the Threshold increases the sensitivity.  Increasing the Threshold decreases the sensitivity.</p>

<h4 id="step-4---attach-led-optional">Step 4 - attach led (optional)</h4>
<p><img src="/images/pulsesensor-lib.png" alt="" /></p>

<p>pro tip - you can also just stick an LED directly into pin 13 and ground!
This is a helpful guide for getting started with the PulseSensor
<a href="https://docs.google.com/document/d/1d8EwDcXH1AZpIpEnrET28EBgStrbkbppxjQZcNRAlkI/edit">https://docs.google.com/document/d/1d8EwDcXH1AZpIpEnrET28EBgStrbkbppxjQZcNRAlkI/edit</a></p>

<h2 id="-️-heart-detector-for-raspberry-pi-️">### ❤️ Heart Detector for Raspberry Pi ❤️</h2>
<p><img src="/images/mpc30081.jpeg" alt="" />
<img src="/images/mpc3008adc.gif" alt="" />
This guide will show you an easier way to install and use new Python code to talk to the MCP3008 ADC.</p>

<p>The MCP3008 datasheet is also an important resource to skim and have handy.</p>

<h1 id="wiring">Wiring</h1>
<p>The MCP3008 connects to the Raspberry Pi using a SPI serial connection.  You can use either the hardware SPI bus, or any four GPIO pins and software SPI to talk to the MCP3008.  Software SPI is a little more flexible since it can work with any pins on the Pi, whereas hardware SPI is slightly faster but less flexible because it only works with specific pins.  If you aren’t sure which to use I recommend software SPI as it’s easier to setup.</p>

<p>Before you can wire the chip to the Pi you first need to place it into a breadboard.  If you haven’t used bare DIP chips like the MCP3008 before you want to press it into the breadboard so its legs straddle the empty channel in the middle of the breadboard.  This way you can access each of the legs of the chip from the breadboard.</p>

<p>Note that the orientation of the chip matters!  Be sure to place it with the half circle indention and dot towards the top.  See the photo below for an example:</p>

<h1 id="software-spi">Software SPI</h1>
<p>To connect the MCP3008 to the Raspberry Pi with a software SPI connection you need to make the following connections:</p>

<ul>
  <li>MCP3008 VDD to Raspberry Pi 3.3V</li>
  <li>MCP3008 VREF to Raspberry Pi 3.3V</li>
  <li>MCP3008 AGND to Raspberry Pi GND</li>
  <li>MCP3008 DGND to Raspberry Pi GND</li>
  <li>MCP3008 CLK to Raspberry Pi pin 18</li>
  <li>MCP3008 DOUT to Raspberry Pi pin 23</li>
  <li>MCP3008 DIN to Raspberry Pi pin 24</li>
  <li>MCP3008 CS/SHDN to Raspberry Pi pin 25</li>
</ul>

<p>Note that you can swap the MCP3008 CLK, DOUT, DIN, and CS/SHDN pins to any other free digital GPIO pins on the Raspberry Pi.  You’ll just need to modify the example code to use your pins.</p>

<h1 id="library-install">Library Install</h1>
<p>After you’ve wired the MCP3008 to the Raspberry Pi with either the software or hardware SPI wiring you’re ready to install the Adafruit MCP3008 Python library.</p>

<p>You can install the library from the Python package index with a few commands, or you can install the library from its source on GitHub.  Pick one of these options below.  If you aren’t sure I recommend installing from source on GitHub because it will also download examples to use the library.</p>

<p>Note that before you install the library your Raspberry Pi must be connected to the internet through a wired or wireless network connection.</p>

<h1 id="install-dependencies">Install dependencies</h1>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get install build-essential python-dev python-smbus git
cd ~
git clone https://github.com/adafruit/Adafruit_Python_MCP3008.git
cd Adafruit_Python_MCP3008
sudo python setup.py install
</code></pre></div></div>
<h1 id="edit-the-code">Edit the code</h1>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano simpletest.py
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Software SPI configuration:
CLK  = 18
MISO = 23
MOSI = 24
CS   = 25
mcp = Adafruit_MCP3008.MCP3008(clk=CLK, cs=CS, miso=MISO, mosi=MOSI)

# Hardware SPI configuration:
# SPI_PORT   = 0
# SPI_DEVICE = 0
# mcp = Adafruit_MCP3008.MCP3008(spi=SPI.SpiDev(SPI_PORT, SPI_DEVICE))
</code></pre></div></div>
<p>The example will print out a table with all of the ADC channels and their values.  Every half second a new row will be printed with the latest channel values.  For example you might see output like:
<img src="/images/adc-example.png" alt="" /></p>

<p>Once you have a signal coming in from the ADC you can begin to develop the code to do different things, like turn on an LED for every hear beats
e.g.
<img src="/images/heart-example-small.png" alt="" /></p>

<p>The code below takes an average reading and flashes an LED (on GPIO 2) when it detects a heartbeat</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Simple example of reading the MCP3008 analog input channels
# Author: Tony DiCola
# License: Public Domain
import time
# Import SPI library (for hardware SPI) and MCP3008 library.
import Adafruit_GPIO.SPI as SPI
import Adafruit_MCP3008
import RPi.GPIO as GPIO           # import RPi.GPIO module


GPIO.setmode(GPIO.BCM)            # choose BCM or BOARD
GPIO.setup(2, GPIO.OUT) # set a port/pin as an output

# Software SPI configuration:
CLK  = 18
MISO = 23
MOSI = 24
CS   = 25
mcp = Adafruit_MCP3008.MCP3008(clk=CLK, cs=CS, miso=MISO, mosi=MOSI)

MAX_HISTORY = 250

# Maintain a log of previous values to
# determine min, max and threshold.
history = []

print('Press Ctrl-C to quit...')
while True:
    # Grab the difference between channel 0 and 1 (i.e. channel 0 minus 1).
    # Note you can specify any value in 0-7 to grab other differences:
    #  - 0: Return channel 0 minus channel 1
    #  - 1: Return channel 1 minus channel 0
    #  - 2: Return channel 2 minus channel 3
    #  - 3: Return channel 3 minus channel 2
    #  - 4: Return channel 4 minus channel 5
    #  - 5: Return channel 5 minus channel 4
    #  - 6: Return channel 6 minus channel 7
    #  - 7: Return channel 7 minus channel 6
    v = mcp.read_adc(1)
    # print('Channel 1: {0}'.format(v))
    # time.sleep(0.5)
    history.append(v)

    # Get the tail, up to MAX_HISTORY length
    history = history[-MAX_HISTORY:]

    minima, maxima = min(history), max(history)

    threshold_on = (minima + maxima * 3) // 4   # 3/4
    threshold_off = (minima + maxima) // 2      # 1/2

    if v &gt; threshold_on:
        GPIO.output(2, True)

    if v &lt; threshold_off:
       GPIO.output(2, False)
</code></pre></div></div>

<p>References
<a href="https://learn.adafruit.com/raspberry-pi-analog-to-digital-converters/mcp3008#library-install-2-11">Adafruit MPC3008 tutotorial</a>
<a href="https://www.twobitarcade.net/article/wemos-heart-rate-sensor-display-micropython/">Heart Beat BPM</a></p>

<p><a href="pg6.md">Next</a>
<a href="pg4.md">Back</a></p>

  </div><a class="u-url" href="/education/2019/03/16/heart-sensor-rpi.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Agorama</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <p>Rebecca's Flat <br>
            56a Artillery Lane<br>
            London<br>
            E1 7LS<br>
          </p>
          <!-- <li class="p-name">Agorama</li> --><li><a class="u-email glitch-link" href="mailto:admin@agorama.org.uk"><span class="glitch">admin@agorama.org.uk</span></a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a class="glitch-link" href="https://github.com/agoramaHub"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username"><span class="glitch">agoramaHub</span></span></a></li><li><a class="glitch-link" href="https://www.instagram.com/agorama_"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#instagram"></use></svg> <span class="username"><span class="glitch">agorama_</span></span></a></li><li><a class="glitch-link" href="https://twitter.com/agorama_"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username"><span class="glitch">agorama_</span></span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <a class="u-email glitch-link" href="https://home.agorama.org.uk/"><span class="glitch">Agorama</span></a>
        <p>This website is best experienced with <a class="u-email glitch-link" href="https://beakerbrowser.com/"><span class="glitch">Beaker Browser</span></a> and <a class="u-email glitch-link" href="dat://home.agorama.org.uk/"><span class="glitch">DAT</span></a></p>
        <a class="glitch-link" href="https://hashbase.io/agoramahub">
          <span class="glitch">
          <img src="/assets/hashbase_logo.png" width="30%">
          </span>
        </a>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
